---
title: Hyper-V虚拟机网络设置
date: 2019-08-07 11:23:18
categories: 虚拟机
tags: 虚拟机
---

## Hyper-V虚拟机网络设置
1.需求
>* 无论物理机的网络环境怎么变化，都需要保持虚拟机的IP地址不变，保证我本机使用xshell等终端访问始终用同一个IP地址，或者在安装了其他软件后，访问虚拟机的IP地址保持不变。
>* 物理机可访问虚拟机，虚拟机可访问网络都行。重点保证本机可访问虚拟机，以及虚拟机之间能互相访问。
>* 无论物理机的网络环境怎么变化，虚拟机可以连接到外网。

2.检查 
>Hyper-V的网卡配置使用“虚拟交换机管理器”配置，创建虚拟交换机时，“外部”简单但是虚拟机ip地址会经常变，“内部”即常说的NAT网络，
可以配置固定ip，这里重点说这种方式；开始前需要检查：目前windows的NAT虚拟网络只能支持一个，因此在开始创建NAT网络前需要先
检查是否已存在NAT网络。检查可以直接查看网络适配器列表，看看是否由多个Hyper-V网络适配器，只允许一个Hyper-V默认交换机和即将
要使用的，其他的即使显示不可用的也要删除，删除方法之一是：在设备管理器中删除网络适配器；

3.配置Hyper-V网络适配器并固定IP
>* 新建虚拟机.(略)
>* 创建一个内部方式的虚拟交换机，取名假设test
>* 在虚拟机的网络适配器上配置刚新建的test；
>* 设置虚拟交换机test的IP；![](/images/vm_1.png)
>* 修改虚拟机IP； ![](/images/vm_2.png)
>* 重启虚拟机网路：systemctl restart network，查看IP：ip addr show；

4. 连接外网
> 前面介绍，Hyper-V有个默认交换机，通过这个交换机就可以连接外网且无须额外配置；需要将这个默认交换机配置到新建的虚拟机中，
且注意先后顺序，必须先配置默认的test适配器才能绑定固定IP；配置默认交换机前需要关闭虚拟机，最终配置如下图：
![](/images/vm_3.png)

5. 扩展
> 如果需要配置多个虚拟机脸网，如上步骤，核心配置test适配器固定IP，使用默认交换机联网；xshell使用test网络适配器中配置的静态IP.