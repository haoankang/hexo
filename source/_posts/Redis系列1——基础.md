---
title: Redis系列1——基础
date: 2020-02-25 21:04:00
categories: redis
tags: redis
---
redis简介.
>简单来说，redis就是一个基于内存的数据库；因为读写非常快，高性能且高并发，所以被广泛用于缓存方向；redis用多种数据类型来支持不同的业务场景；
>redis支持事务、持久化、lua脚本、LRU驱动事件、多种集群方案；

1. redis单线程为什么这么快.
>1. 纯内存；
>2. 非阻塞IO；
>3. 单线程避免了线程切换和竞争消耗；

2. redis特性.
>* 速度快；
>* 持久化；
>* 多种数据结构；
>* 支持多种编程语言；
>* 功能丰富；
>* 简单；
>* 主从复制；
>* 高可用，分布式；

3. 应用场景.
>* 缓存系统；
>* 计数器；
>* 实时系统；
>* 排行榜；
>* 社交网络；
>* 消息队列系统；

4. 基本数据类型.
>* string字符串；可以是字符串、整形、浮点型；
>* list；一个双向链表，链表的每个节点上都包含一个字符串；
>* set；包含字符串的无序收集器；
>* zset；字符串成员与浮点数分值之间的有序映射，元素的排列顺序由分值的大小确定；
>* hash；包含键值对的无序散列表；

5. redis线程模型.
>redis内部使用文件事件处理器File event handler，这个文件事件处理器是单线程的，所以redis被称为单线程的；它采用IO多路复用机制监听
>多个socket，根据socket上事件来选择对应的事件处理器进行处理；
>
>这个文件事件处理器包含4个部分：
>* 多个socket；
>* IO多路复用程序；
>* 文件事件分派器；
>* 事件处理器；

6. redis与Memcached的区别.
>1. redis支持更丰富的数据类型；Memcached只有string类型；
>2. redis支持持久化；Memcached不支持；
>3. memcached原生不支持集群，而redis支持集群；
>4. memcached是多线程、非阻塞IO复用的网络模型，Redis是单线程IO多路复用模型；

7. redis过期时间和淘汰机制；
>redis可以设置expire time过期时间；redis使用定期删除+惰性删除维护key，注意定期删除是随机抽取的；
>
>redis内存淘汰机制：
>* volatile-lru：从已设置过期时间的数据集（server.db[i].expires）中挑选最近最少使用的数据淘汰；
>* volatile-ttl：从已设置过期时间的数据集（server.db[i].expires）中挑选将要过期的数据淘汰；
>* volatile-random：从已设置过期时间的数据集（server.db[i].expires）中任意选择数据淘汰；
>* allkeys-lru：当内存不足以容纳新写入数据时，在键空间中，移除最近最少使用的key（这个是最常用的）；
>* allkeys-random：从数据集（server.db[i].dict）中任意选择数据淘汰；
>* no-eviction：禁止驱逐数据，也就是说当内存不足以容纳新写入数据时，新写入操作会报错。一般不用；
>* volatile-lfu：从已设置过期时间的数据集(server.db[i].expires)中挑选最不经常使用的数据淘汰；
>* allkeys-lfu：当内存不足以容纳新写入数据时，在键空间中，移除最不经常使用的key；

8. redis持久化机制.
>* 快照RDB.Redis可以通过创建快照来获得存储在内存里面的数据在某个时间点上的副本。创建快照的几种方式：
>>* BGSAVE命令；
>>* SAVE命令；
>>* save选项；
>>* SHUTDOWN命令；
>>* 一个redis服务器连接另一个redis服务器；
>* 只追加文件AOF.开启AOF持久化后每执行一条会更改Redis中的数据的命令，Redis就会将该命令写入硬盘中的AOF文件。

重写/压缩AOF.
>AOF虽然在某个角度可以将数据丢失降低到最小而且对性能影响也很小，但是极端的情况下，体积不断增大的AOF文件很可能会用完硬盘空间。另外，如果AOF体积过大，那么还原操作执行时间就可能会非常长。
>为了解决AOF体积过大的问题，用户可以向Redis发送 BGREWRITEAOF命令 ，这个命令会通过移除AOF文件中的冗余命令来重写（rewrite）AOF文件来减小AOF文件的体积。
>BGREWRITEAOF命令和BGSAVE创建快照原理十分相似，所以AOF文件重写也需要用到子进程，这样会导致性能问题和内存占用问题，和快照持久化一样。更糟糕的是，如果不加以控制的话，AOF文件的体积可能会比快照文件大好几倍。

9. Redis事务.
>Redis通过MULTI、EXEC、WATCH等命令实现事务功能；事务通过一次性将多个命令打包，然后一次性、顺序执行；redis事务总是具有ACI特性；
>
>redis同一个事务中如果有一条命令执行失败，其后的命令仍然会被执行，没有回滚。

10. 缓存雪崩、缓存穿透、缓存击穿。
>* 缓存雪崩. 缓存同一时间大面积的失效，所以，后面的请求都会落到数据库上，造成数据库短时间内承受大量请求而崩掉。
>解决方案.一般用设置随机过期时间；