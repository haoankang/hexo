---
title: IO二三事1——基础篇
date: 2019-11-08 19:56:58
categories:
tags: I/O
---

##1. 前言.
I/O是一个大命题，从最基础的入门API操作，到高级的网络IO、NIO、Netty等，软件本质上就是输入输出和处理，
因此IO占了很重要一部分，这里不指望涵盖方方面面，但作为自己知识体系的一部分，还是有必要梳理一下的；

经常碰到的一些面试问题如：
* 同步、异步、阻塞、非阻塞之间的关系和区别？
* IO模型有哪些，有什么特点，它们之间有什么区别？
* NIO有哪些优势，netty为什么高效？

这些问题感觉熟悉又陌生，大部分人知道二三，但是又经不住刨根问底，这篇就先理清基础概念，有助于后续问题分析.

##2. 基础概念.
###1. IO过程
本地输入操作包含过程：
* 等待数据准备好
* 从内核向进程复制数据

网络数据输入包含过程：
* 等待数据从网络送达，到达后被复制到内核缓冲区
* 把数据从内核缓冲区复制到程序缓冲区

###2. 阻塞和非阻塞、同步与异步
* 同步和异步————消息如何通知(client).
* 阻塞和非阻塞————(client)等待消息通知时的状态.
简单例子：小明下载文件.
* 小明一直干等着下载完成————同步、阻塞
* 小明边玩手机边等着下载完成————同步、非阻塞
* 软件下载完成有提示，小明一直等着提示音————异步、阻塞
* 软件下载完成有提示，小明玩手机看书直到听到提示音————异步、非阻塞

###3. unix的IO模型
unix网络编程把IO模型分为5类，分别如下：
1. 阻塞I/O：
    >在进程空间内调用时，数据传到内核空间并从内核空间复制到用户空间、或者调用
    发生错误时才会返回，期间一直阻塞等待；
2. 非阻塞I/O：
    >在数据到达内核阶段，如果该缓冲区没有数据，则会直接返回错误；非阻塞IO会轮询
    这个状态，看内核是否有数据到达；
3. I/O复用：
    >linux提供select/poll，进程通过将一个或多个fd传递给select或poll系统调用，
    阻塞在select上，这样select/poll可以侦测多个fd是否处于就绪状态；select/poll
    使用顺序扫描，并且支持的fd数量有限；linux提供epoll系统调用，使用事件驱动，
    当有fd准备就绪时，立即回调，效率更高；
4. 信号驱动I/O：
    >首先开启套接口信号驱动IO功能，并通过系统调用sigaction执行一个信号处理函数，
    当数据准备就绪时，为该进程生成一个信号，通过信号回调通知应用程序；
5. 异步I/O：
    >告知内核启动某个操作，并在内核操作完成后通知进程；和信号驱动的主要区别是：信号
    驱动IO由内核通知我们何时可以操作，异步IO由内核通知我们操作已经完成；

区别可以用下面图片概括：
![](/images/IO_1.png)