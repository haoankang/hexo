---
title: '''Mysql系列5——补充'''
date: 2020-02-25 16:41:25
categories: mysql
tags: mysql
---
##1. 索引.
索引的优点.（优点就是要从时间、空间考虑）
>* 大大减少了服务器需要扫描的数据行数；
>* 帮助服务器避免了进行排序和分组，以及避免创建临时表；
>* 将随机IO变为顺序IO；

索引为什么可以加快检索速度？
>索引使无序的数据变为有序的数据，然后利用算法如二分类的检索；以B+树为例，索引会减少磁盘IO次数；

索引优化.
>* 独立索引.
>* 多列索引.
>* 索引列的顺序.让选择性强、即基数大的列放在前面；
>* 前缀索引.
>* 覆盖索引.

索引类型.
>主键索引(primary key)、唯一索引(unique key)、普通索引(key)、全文索引.

索引失效.
>* 如果优化器分析全表扫描比使用索引快，则不走索引；
>* 如果条件中有or，则不走索引；
>* 复合索引，如果不符合最左前缀原则，则不走索引；
>* like以%开头；
>* 其他；

为什么用B+树而不是B树和红黑树做索引？
>首先Mysql是以磁盘IO次数衡量查询效率的；B树和B+树层级很少，目的就是为了减少磁盘IO次数，但B树节点存储数据，因此节点较大，磁盘IO一次读取
>的数据有限，单个数据变大，就需要多次IO，因此更加耗时；B+树数据都在叶子节点，因此可以将所有叶子节点用指针串起来，这样就能顺序IO访问速度
>更快；
>
>红黑树层级过多，不适合存储大数据量；

##2. 数据切分.
切分类型：
>* 水平切分：将一个表的数据拆分到多个表中，例如将订单按时间每天切分；
>* 垂直切分：将一个表列切分到多个表中，可以根据列是否经常使用等切分，例如订单号和用户id；

切分策略：
>哈希取模（hash(key)%N）、范围、映射表；

切分存在的问题：
>* 分布式事务问题；
>* 连接；
>* ID唯一性；

分库分表中间件：
sharding-jdbc：client层方案，优点：不用部署额外中间件，运维成本低，不需要代理曾二次转发请求，性能高；缺点：耦合度高；
Mycat：proxy层方案，优点：对于各项目透明；

分布式ID生成方案：
>* UUID
>* 数据库自增ID
>* 批量生成ID
>* Redis生成ID
>* Twitter的snowflake算法
>* 其他分布式ID生成器

##3. 主从复制和读写分离.
主从复制.
>主要涉及三个线程：
>* binlog线程：负责将主数据库上的数据更改写入二进制文件binlog中；
>* IO线程：负责从主数据库上读取二进制文件，并写入从服务器的中继日志中；
>* SQL线程：负责读取中继日志并重放其中的SQL语句；
>
>高并发场景下，从库数据一定比主库慢一些，是有延时的；mysql在主从复制这块有两个机制：半同步复制用来解决主库
>数据丢失，并行复制用来解决主从延时问题；
>
>主从同步延时问题解决方案：
>>* 分库，将一个主库拆分成多个主库，每个主库的并发量就减少了几倍，此时主从延迟可以忽略不计；
>>* 开启Mysql的并行复制机制；
>>* 代码层注意问题；
>>* 严格要求的情况下，就读主库；

读写分离.
>主服务器用来处理写操作和实时性要求较高的读操作，从服务器处理读请求；可以用动态数据源切换方式实现；

主从不一致：
>业务可以接受，系统不优化；
>强制读主库；
>在cache中记录发生了哪些写操作，来路由读主库还是从库；