---
title: '''Elasticsearch系列1'''
date: 2020-02-27 17:15:36
categories: es
tags: es
---

###1. es的术语
>* index.
>* type.(已废弃)
>* mapping.
>* document.
>* field.

###2. es分布式架构原理.
es存储数据的基本单位是索引，索引可以拆分成多个shard，每个shard存储部分数据，shard可备份多个部署在不同节点上；
es集群多个节点，会自动选举一个master节点，master负责管理工作，如维护索引元数据、切换shard备份；

###3. es写入数据过程.（工作原理）
>1. 客户端选择一个node发送请求过去，这个node就作为协调节点；
>2. 协调节点对document进行路由，将请求转发给对应的node（有primary shard)；
>3. 处理写入的node，将数据同步给replica shard.
>4. 协调节点将响应结果发给客户端；

###4. es读数据过程.(工作原理)
>1. 客户端选择一个node作为协调节点；
>2. 协调服务器对docId进行哈希路由，将请求转发给对应的node；
>3. 接收请求的node返回document给协调服务器；
>4. 协调服务器返回document给客户端；

###5. es搜索数据过程.
>1. 客户端选择一个node作为协调节点；
>2. 协调节点将搜索请求转发给所有节点；
>3. 每个shard将自己的搜索结果返回给协调服务器，协调服务器进行数据整合；
>4. 协调节点根据docId去各个节点上拉取实际数据；

###6. 倒排索引.
>正序索引是从index到word，倒排索引是从word到文档；
>* 倒排索引中的所有词对应一个或多个文档；
>* 倒排索引中的词项根据字典顺序升序排列；

###7. es在数据量很大的情况下（数十亿），如何提升查询效率.
>部署建议
>* 选择合理的硬件配置，尽可能使用SSD；
>* 给JVM配置机器的一半内存，建议不超过32G；
>* 规模较大的集群配置专有主节点，避免脑裂问题；
>* linux系统调优；
>
>索引性能优化
>* 设置合理的索引分片数和副本数；
>* 使用批量请求；
>* 通过多线程/多进程发送数据；
>* 调大refresh interval:
>* 设计mapping配置合适字段类型；
>
>查询性能优化
>* 使用过滤器缓存和分片查询缓存；
>* 使用路由；
>* 强制合并只读索引，关闭历史数据索引；
> 
